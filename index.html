<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RecoWatch - Movie & TV Show Recommender</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #a78bfa;
            cursor: pointer;
        }
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #a78bfa;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        function MovieRecommender() {
            const [searchQuery, setSearchQuery] = useState('');
            const [recommendations, setRecommendations] = useState([]);
            const [loading, setLoading] = useState(false);
            const [searchedTitle, setSearchedTitle] = useState('');
            const [searchedTitleProfile, setSearchedTitleProfile] = useState(null);
            const [showFilters, setShowFilters] = useState(false);
            
            const [dimensions, setDimensions] = useState({
                tone: 50,
                pacing: 50,
                complexity: 50,
                emotionalWeight: 50,
                style: 50,
                maturity: 50,
                dialogueAction: 50,
                socialCommentary: 50
            });

            const dimensionLabels = {
                tone: { left: 'Dark & Gritty', right: 'Light & Uplifting' },
                pacing: { left: 'Slow Burn', right: 'Fast-Paced' },
                complexity: { left: 'Simple Plot', right: 'Complex Plot' },
                emotionalWeight: { left: 'Light Entertainment', right: 'Emotionally Heavy' },
                style: { left: 'Realistic', right: 'Stylized/Fantastical' },
                maturity: { left: 'Family-Friendly', right: 'Mature Content' },
                dialogueAction: { left: 'Dialogue-Heavy', right: 'Action-Heavy' },
                socialCommentary: { left: 'Minimal Commentary', right: 'Heavy Commentary' }
            };

            const dimensionNames = {
                tone: 'Tone',
                pacing: 'Pacing',
                complexity: 'Complexity',
                emotionalWeight: 'Emotional Weight',
                style: 'Style',
                maturity: 'Maturity',
                dialogueAction: 'Dialogue/Action',
                socialCommentary: 'Social Commentary'
            };

            const handleSliderChange = (dimension, value) => {
                setDimensions(prev => ({ ...prev, [dimension]: value }));
            };

            const applyProfileAsFilters = (profile) => {
                setDimensions(profile);
                setShowFilters(true);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const handleSearch = async () => {
                if (!searchQuery.trim()) return;

                setLoading(true);
                setSearchedTitle(searchQuery);
                
                try {
                    const preferences = Object.entries(dimensions)
                        .map(([key, value]) => {
                            const label = dimensionLabels[key];
                            let preference = '';
                            if (value < 40) preference = `strongly prefer ${label.left}`;
                            else if (value < 48) preference = `prefer ${label.left}`;
                            else if (value > 60) preference = `strongly prefer ${label.right}`;
                            else if (value > 52) preference = `prefer ${label.right}`;
                            else preference = 'neutral';
                            return `${dimensionNames[key]}: ${preference}`;
                        })
                        .join(', ');

                    const response = await fetch("https://api.anthropic.com/v1/messages", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 3000,
                            messages: [
                                {
                                    role: "user",
                                    content: `Find 6 movies or TV shows similar to "${searchQuery}" that match these preferences: ${preferences}

FIRST, provide the content profile for "${searchQuery}" itself.

THEN provide 6 recommendations.

For the searched title and each recommendation, provide:
1. The title
2. A brief 1-sentence description
3. A detailed explanation of why it's similar (for recommendations only, skip for searched title)
4. Ratings (0-100) for each dimension:
   - tone: 0=Dark & Gritty, 100=Light & Uplifting
   - pacing: 0=Slow Burn, 100=Fast-Paced
   - complexity: 0=Simple Plot, 100=Complex Plot
   - emotionalWeight: 0=Light Entertainment, 100=Emotionally Heavy
   - style: 0=Realistic, 100=Stylized/Fantastical
   - maturity: 0=Family-Friendly, 100=Mature Content
   - dialogueAction: 0=Dialogue-Heavy, 100=Action-Heavy
   - socialCommentary: 0=Minimal Commentary, 100=Heavy Commentary

Respond ONLY with valid JSON:
{
  "searchedTitle": {
    "title": "${searchQuery}",
    "description": "Description",
    "dimensions": {
      "tone": 65,
      "pacing": 70,
      "complexity": 80,
      "emotionalWeight": 75,
      "style": 60,
      "maturity": 85,
      "dialogueAction": 40,
      "socialCommentary": 50
    }
  },
  "recommendations": [
    {
      "title": "Title",
      "description": "Description",
      "similarity": "Explanation",
      "dimensions": {
        "tone": 65,
        "pacing": 70,
        "complexity": 80,
        "emotionalWeight": 75,
        "style": 60,
        "maturity": 85,
        "dialogueAction": 40,
        "socialCommentary": 50
      }
    }
  ]
}

DO NOT include any text outside the JSON. Your entire response must be a single valid JSON object.`
                                }
                            ]
                        })
                    });

                    const data = await response.json();
                    let responseText = data.content[0].text;
                    responseText = responseText.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();
                    const result = JSON.parse(responseText);
                    setSearchedTitleProfile(result.searchedTitle);
                    setRecommendations(result.recommendations);
                } catch (error) {
                    console.error("Error fetching recommendations:", error);
                    alert("Sorry, there was an error getting recommendations. Please try again.");
                } finally {
                    setLoading(false);
                }
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter') {
                    handleSearch();
                }
            };

            const getDimensionColor = (value) => {
                if (value < 33) return 'bg-blue-400';
                if (value < 67) return 'bg-purple-400';
                return 'bg-pink-400';
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-900 via-indigo-900 to-blue-900 p-6">
                    <div className="max-w-6xl mx-auto">
                        {/* Header */}
                        <div className="text-center mb-8 pt-8">
                            <div className="flex items-center justify-center gap-3 mb-4">
                                <svg className="w-12 h-12 text-purple-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                    <line x1="7" y1="2" x2="7" y2="22" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                    <line x1="17" y1="2" x2="17" y2="22" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                    <line x1="2" y1="12" x2="22" y2="12" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                    <line x1="2" y1="7" x2="7" y2="7" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                    <line x1="2" y1="17" x2="7" y2="17" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                    <line x1="17" y1="17" x2="22" y2="17" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                    <line x1="17" y1="7" x2="22" y2="7" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                </svg>
                                <h1 className="text-5xl font-bold text-white">RecoWatch</h1>
                            </div>
                            <p className="text-purple-200 text-lg">
                                Discover your next favorite with intelligent recommendations
                            </p>
                        </div>

                        {/* Search Bar */}
                        <div className="mb-6">
                            <div className="relative max-w-2xl mx-auto">
                                <input
                                    type="text"
                                    value={searchQuery}
                                    onChange={(e) => setSearchQuery(e.target.value)}
                                    onKeyPress={handleKeyPress}
                                    placeholder="Enter a movie or TV show..."
                                    className="w-full px-6 py-4 pr-14 text-lg rounded-2xl bg-white/10 backdrop-blur-lg border border-white/20 text-white placeholder-purple-200 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent"
                                />
                                <button
                                    onClick={handleSearch}
                                    disabled={loading}
                                    className="absolute right-2 top-1/2 transform -translate-y-1/2 p-3 bg-purple-500 hover:bg-purple-600 rounded-xl transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    {loading ? (
                                        <svg className="w-5 h-5 text-white animate-spin" fill="none" viewBox="0 0 24 24">
                                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                        </svg>
                                    ) : (
                                        <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <circle cx="11" cy="11" r="8" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                            <path d="m21 21-4.35-4.35" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                        </svg>
                                    )}
                                </button>
                            </div>
                        </div>

                        {/* Filter Toggle */}
                        <div className="text-center mb-8">
                            <button
                                onClick={() => setShowFilters(!showFilters)}
                                className="inline-flex items-center gap-2 px-6 py-3 bg-white/10 hover:bg-white/20 backdrop-blur-lg border border-white/20 rounded-xl text-white transition-colors"
                            >
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <line x1="21" y1="4" x2="14" y2="4" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                    <line x1="10" y1="4" x2="3" y2="4" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                    <line x1="21" y1="12" x2="12" y2="12" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                    <line x1="8" y1="12" x2="3" y2="12" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                    <line x1="21" y1="20" x2="16" y2="20" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                    <line x1="12" y1="20" x2="3" y2="20" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                    <line x1="14" y1="2" x2="14" y2="6" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                    <line x1="8" y1="10" x2="8" y2="14" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                    <line x1="16" y1="18" x2="16" y2="22" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                </svg>
                                {showFilters ? 'Hide' : 'Show'} Preference Filters
                            </button>
                        </div>

                        {/* Filters */}
                        {showFilters && (
                            <div className="max-w-4xl mx-auto mb-12 bg-white/10 backdrop-blur-lg border border-white/20 rounded-2xl p-8">
                                <h3 className="text-xl font-semibold text-white mb-6 text-center">
                                    Customize Your Recommendations
                                </h3>
                                <div className="grid gap-6">
                                    {Object.entries(dimensions).map(([key, value]) => (
                                        <div key={key}>
                                            <div className="flex justify-between items-center mb-2">
                                                <span className="text-sm text-purple-200">{dimensionLabels[key].left}</span>
                                                <span className="text-xs font-semibold text-white">{dimensionNames[key]}</span>
                                                <span className="text-sm text-purple-200">{dimensionLabels[key].right}</span>
                                            </div>
                                            <input
                                                type="range"
                                                min="0"
                                                max="100"
                                                value={value}
                                                onChange={(e) => handleSliderChange(key, parseInt(e.target.value))}
                                                className="w-full h-2 bg-white/20 rounded-lg appearance-none cursor-pointer slider"
                                            />
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Results */}
                        {searchedTitle && !loading && recommendations.length > 0 && (
                            <div>
                                {/* Searched Title Profile */}
                                {searchedTitleProfile && (
                                    <div className="mb-8">
                                        <h2 className="text-2xl font-semibold text-white mb-4 text-center">
                                            Content Profile: <span className="text-purple-300">{searchedTitleProfile.title}</span>
                                        </h2>
                                        <div className="max-w-2xl mx-auto bg-gradient-to-br from-purple-500/20 to-blue-500/20 backdrop-blur-lg border-2 border-purple-400/50 rounded-2xl p-6">
                                            <p className="text-purple-100 text-sm mb-6 italic text-center">
                                                {searchedTitleProfile.description}
                                            </p>
                                            
                                            <div className="text-center mb-4">
                                                <button
                                                    onClick={() => applyProfileAsFilters(searchedTitleProfile.dimensions)}
                                                    className="px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white text-sm font-semibold rounded-lg transition-colors"
                                                >
                                                    Use as Preference Filters
                                                </button>
                                            </div>
                                            
                                            {/* Dimension Indicators */}
                                            <div className="border-t border-white/20 pt-4">
                                                <p className="text-xs font-semibold text-purple-300 mb-3 text-center">
                                                    CONTENT DIMENSIONS:
                                                </p>
                                                <div className="grid grid-cols-2 gap-3">
                                                    {Object.entries(searchedTitleProfile.dimensions).map(([dim, val]) => (
                                                        <div key={dim} className="flex items-center gap-2">
                                                            <span className="text-xs text-purple-200 w-24 truncate">
                                                                {dimensionNames[dim]}:
                                                            </span>
                                                            <div className="flex-1 bg-white/10 rounded-full h-2 overflow-hidden">
                                                                <div
                                                                    className={`h-full ${getDimensionColor(val)} transition-all`}
                                                                    style={{ width: `${val}%` }}
                                                                />
                                                            </div>
                                                            <span className="text-xs text-purple-300 w-8 text-right">
                                                                {val}
                                                            </span>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                <h2 className="text-2xl font-semibold text-white mb-6 text-center">
                                    Similar Titles You Might Enjoy
                                </h2>
                                <div className="grid gap-6 md:grid-cols-2">
                                    {recommendations.map((rec, index) => (
                                        <div
                                            key={index}
                                            className="bg-white/10 backdrop-blur-lg border border-white/20 rounded-2xl p-6 hover:bg-white/15 transition-all"
                                        >
                                            <h3 className="text-xl font-bold text-white mb-2">
                                                {rec.title}
                                            </h3>
                                            <p className="text-purple-200 text-sm mb-4 italic">
                                                {rec.description}
                                            </p>
                                            <div className="border-t border-white/20 pt-4 mb-4">
                                                <p className="text-xs font-semibold text-purple-300 mb-2">
                                                    WHY IT'S SIMILAR:
                                                </p>
                                                <p className="text-purple-100 text-sm leading-relaxed">
                                                    {rec.similarity}
                                                </p>
                                            </div>
                                            
                                            {/* Dimension Indicators */}
                                            <div className="border-t border-white/20 pt-4">
                                                <div className="flex items-center justify-between mb-3">
                                                    <p className="text-xs font-semibold text-purple-300">
                                                        CONTENT PROFILE:
                                                    </p>
                                                    <button
                                                        onClick={() => applyProfileAsFilters(rec.dimensions)}
                                                        className="px-3 py-1 bg-purple-500/50 hover:bg-purple-500 text-white text-xs font-semibold rounded transition-colors"
                                                    >
                                                        Use as Filters
                                                    </button>
                                                </div>
                                                <div className="grid grid-cols-2 gap-3">
                                                    {Object.entries(rec.dimensions).map(([dim, val]) => (
                                                        <div key={dim} className="flex items-center gap-2">
                                                            <span className="text-xs text-purple-200 w-20 truncate">
                                                                {dimensionNames[dim]}:
                                                            </span>
                                                            <div className="flex-1 bg-white/10 rounded-full h-2 overflow-hidden">
                                                                <div
                                                                    className={`h-full ${getDimensionColor(val)} transition-all`}
                                                                    style={{ width: `${val}%` }}
                                                                />
                                                            </div>
                                                            <span className="text-xs text-purple-300 w-8 text-right">
                                                                {val}
                                                            </span>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Loading State */}
                        {loading && (
                            <div className="text-center py-12">
                                <svg className="w-12 h-12 text-purple-300 animate-spin mx-auto mb-4" fill="none" viewBox="0 0 24 24">
                                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                <p className="text-purple-200 text-lg">Finding perfect matches...</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<MovieRecommender />, document.getElementById('root'));
    </script>
</body>
</html>
